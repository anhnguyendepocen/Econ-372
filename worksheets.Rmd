---
title: "In-class Problems"
author: "Econ 372: Economics of Health Care Markets"
date: "Last Update: 1/13/2020"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    toc_depth: 1
    theme: darkly
    number_sections: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, ggplot2, dplyr, lubridate, readr, readxl, hrbrthemes,
               scales, gganimate, gapminder, gifski, png, tufte, plotly, OECD,
               ggrepel)

```

# Overview 
Here are all of our in-class problems and solutions throughout the semester. They are all in one place for ease of use and access. Note that the problems and solutions are "tabbed". That's so that you can view the problem and work on it on your own without seeing the solution. This is definitely the best way to study!

# Expected values {.tabset}

## Problems

### Question 1:
An individual starts with a wealth of <span>&#36;</span>100,000. With probability 0.3, they will get sick and incur a cost of <span>&#36;</span>40,000. What is this person's expected cost of illness?

### Question 2:
Assume this individual has a utility function of the form, $u(w) = w^{0.20}$. What is this person's expected utility?

### Question 3:
Calculate this person's utility if they were to incur the expected cost of illness with certainty. Is this utility higher or lower than what you found in part (2)?


## Solutions

### Question 1:
An individual starts with a wealth of <span>&#36;</span>100,000. With probability 0.3, they will get sick and incur a cost of <span>&#36;</span>40,000. What is this person's expected cost of illness?<br>

The expected cost is the probability of being ill (0.3) times the cost of being ill (40,000),<br><br>
$E[cost]=0.3 \times 40,000 =$ `r format(0.3*40000,digits=5,big.mark=",")`.


### Question 2:
Assume this individual has a utility function of the form, $u(w) = w^{0.20}$. What is this person's expected utility?<br>

Expected utility works the same as any expectation...the "tricky" part is that we're using the utility *function* to the find the values over which we form the expectation. In this case, we have two possible outcomes: a) healthy, which gives us a wealth of <span>&#36;</span>100,000; or b) sick, in which case we incur the cost of illness and end up with <span>&#36;</span>60,000. So to find the expected utility, we need to find the utility associated with each possible wealth value, and then we need to take the expectation over those utility values:

<b>Step 1: Find utility values</b><br>

- If healthy: $u(w)|_{w=100,000} = 100,000^{0.2}=$ `r format(100000^(0.2),digits=5,big.mark=",")`

- If sick: $u(w)|_{w=60,000} = 60,000^{0.2}=$ `r format(60000^(0.2),digits=5,big.mark=",")`

<br>
<b>Step 2: Take the expectation</b><br>
Taking the expectation over these utility values yields: $E[u]=0.7 \times$ `r format(100000^(0.2),digits=5,big.mark=",")` $+0.3 \times$ `r format(60000^(0.2),digits=5,big.mark=",")` $=$ `r format(.7*(100000^(0.2)) + 0.3*(60000^(0.2)),digits=5,big.mark=",")`.


### Question 3:
Calculate this person's utility if they were to incur the expected cost of illness with certainty. Is this utility higher or lower than what you found in part (2)?<br>

If they are definitely going to be sick (i.e., with probability, $p=1$), then we just need to plug in the wealth value in the sick state (60,000) into the utility function, $u=(60,000)^{0.2}=$ `r format(60000^(0.2),digits=5,big.mark=",")`. As should be the case, this is lower than our expected utility from part (2).



# Demand for health insurance {.tabset}
Assume that utility takes the log form, $u(x)=ln(x)$. If someone is healthy, they maintain their current wealth of <span>&#36;</span>100, and if they become ill, they must incur a cost of <span>&#36;</span>50. Answer the following questions based on this setup.

## Problems

### Question 1:
Calculate the risk premium and willingness to pay based on a probability of illness of 0.1.

### Question 2:
Repeat part (1) using a probability of illness of 0.2.

### Question 3:
Repeat part (1) using a probability of illness of 0.5.

### Question 4:
Explain how these values differ and why. What might this say about the profitability of insurance in a market with many sick people?

## Solutions

### Question 1:
Calculate the risk premium and willingness to pay based on a probability of illness of 0.1.<br>

```{r, include=FALSE}
eu <- .1*log(50) + .9*log(100)
inv.u <- exp(eu)
ecost <- .1*50
rprem <- 100 - inv.u-ecost
```
To find the risk premium, we first need to calculate the expected utility: $E[u]=0.1*\ln(50) + 0.9*\ln(100)=$ `r format(eu, digits=4)`. Next, we need to find the monetary value that provides this same level of utility. So we need $y$ such that $u(y)=$ `r format(eu, digits=4)`. Since our utility function is $\ln(x)$, we know that $y =$ exp(`r format(eu, digits=4)`) $=$ `r format(inv.u,digits=4,big.mark=",")`. The risk premium is then the difference between this value and our starting wealth (less the expected cost of care), $\pi =$ 100 - `r format(inv.u,digits=4)` - `r format(ecost, digits=4)` $=$ `r format(rprem, digits=4)`.


### Question 2:
Repeat part (1) using a probability of illness of 0.2.<br>

```{r, include=FALSE}
eu <- .2*log(50) + .8*log(100)
inv.u <- exp(eu)
ecost <- .2*50
rprem <- 100 - inv.u-ecost
```
Repeating that same process yields an expected utility of `r format(eu, digits=4)`. The monetary value that provides this level of utility with certainty is $y =$ exp(`r format(eu, digits=4)`) $=$ `r format(inv.u,digits=4,big.mark=",")`. The risk premium is then the difference between this value and our starting wealth (less the expected cost of care), $\pi =$ 100 - `r format(inv.u,digits=4)` - `r format(ecost, digits=4)` $=$ `r format(rprem, digits=4)`.


### Question 3:
Repeat part (1) using a probability of illness of 0.5.

```{r, include=FALSE}
eu <- .3*log(50) + .7*log(100)
inv.u <- exp(eu)
ecost <- .3*50
rprem <- 100 - inv.u-ecost
```
Repeating that same process yields an expected utility of `r format(eu, digits=4)`. The monetary value that provides this level of utility with certainty is $y =$ exp(`r format(eu, digits=4)`) $=$ `r format(inv.u,digits=4,big.mark=",")`. The risk premium is then the difference between this value and our starting wealth (less the expected cost of care), $\pi =$ 100 - `r format(inv.u,digits=4)` - `r format(ecost, digits=4)` $=$ `r format(rprem, digits=4)`.


### Question 4:
Explain how these values differ and why. What might this say about the profitability of insurance in a market with many sick people?<br>

We see from these examples that the risk premium is increasing as the amount of uncertainty increases. If people are more certain about being ill, then the risk premium is lower. This means that people are unwilling to pay much more than the expected cost of care, leaving less potential profit for insurers.


# Adverse selection {.tabset}
Assume that the insurer's cost function is given by $C=100q - 2q^{2}$, where $q$ denotes the number of people enrolled in the plan. Further assume that the inverse demand function takes the form, $D=110 - 3q$. 

## Problems

### Question 1:
If the insurer enters the market at a price of <span>&#36;</span>65, what is the insurer's profit (or loss)?

### Question 2:
What price does the insurer set next year if they set price equal to average cost in the prior year?

### Question 3:
What is the equilibrium price in this market?


## Solutions
```{r, include=FALSE}
demand <- function(q){
  110 - 3*q
}
cost <- function(q){
  100*q - 2*q^{2}
}
mc <- function(q){
  100 - 4*q
}
ac <- function(q){
  cost(q)/q
}
q.demand <- function(p){
  (110-p)/3
}
```

### Question 1:
If the insurer enters the market at a price of <span>&#36;</span>65, what is the insurer's profit (or loss)?<br>

we need to first calculate the marginal cost curve, $mc=100-4q$, and the average cost curve, $ac=100-2q$. At a price of $p=65$, we know that quantity demanded will be $q=$ `r q.demand(65)`. We can then calculate profit as just total revenue less total cost, $\pi = TR - TC =$ `r 65*q.demand(65)` - `r ac(q.demand(65))*q.demand(65)` = `r 65*q.demand(65) - ac(q.demand(65))*q.demand(65)`.

### Question 2:
What price does the insurer set next year if they set price equal to average cost in the prior year?<br>

Average cost at $p=65$ is `r ac(q.demand(65))`. So this is next period's price.

### Question 3:
What is the equilibrium price in this market?<br>

The equlibrium price is such that insurers earn zero profits (under our assumptions). We can find that price by finding the quantity such that $AC=p$. This occurs at $110 - 3q = 100 - 2q$, or $q=10$. The price at this quantity is `r demand(10)`. Note that the zero profit condition isn't necessary to find an equilibrium in this way. We could easily incorporate some minimum "profit" per person by increasing the per unit costs in the cost function.



# Physician agency {.tabset}
Denote the quantity of care consumed by $x$, and denote by $B(x)$ the function that determinesthe benefit of care to the patient. Assume that the patient must pay the full price of care, $px$,  so that their net benefit is $NB=B(x)−px$.  

## Problems

### Question 1:
Find the patient’s optimal $x$.

### Question 2:
Draw the marginal benefit on a graph and note the price and patient's optimal quantity.

### Question 3:
Find the physician's optimal $x$ assuming $NB^{0}=0$. 

### Question 4:
Add the physician's optimal $x$ to your graph and interpret the difference.


## Solutions

### Question 1:
Find the patient’s optimal $x$.<br>

The patient just wants to maximize their net benefit, $B(x) - px$. Taking the derivative and setting to 0, this means $B'(x) = p$ (i.e., marginal benefit to the patient is equal to the patient's marginal cost).


### Question 2:
Draw the marginal benefit on a graph and note the price and patient's optimal quantity.<br>

```{tikz echo=FALSE, fig.ext='png', cache=TRUE, tikz-agency}
\usetikzlibrary{calc}
\begin{tikzpicture}[scale=0.70, every node/.style={black,opacity=1, transform shape}]
\draw [->] (0,0) node [below] {0} -- (0,0) -- (6,0) node [right] {$x$};
\draw [->] (0,0) node [below] {0} -- (0,0) -- (0,5.5) node [above] {$NB$};
\draw (0,5)--(6,1.4);
\node [right] at (6,1.4) {$b(x)$};
\draw (0,3.5)--(2.5,3.5);
\draw[dashed] (2.5,3.5)--(2.5,0);
\node [left] at (0,3.5) {$p$};
\node [below] at (2.5,0) {$\bar{x}$};
\end{tikzpicture}
```


### Question 3:
Find the physician's optimal $x$ assuming $NB^{0}=0$.<br>

The physician is profit maximizing, subject to the constraint that $NB^{0}=B(x) - px=0$. Plugging this constraint into the profit function yields, $\pi = B(x) - NB^{0} - cx = B(x) - cx$. Taking the derivative and setting it to 0 yields the expression, $B'(x)=c$. So the physician also set's marginal benefit equal to marginal cost...they just focus on their own marginal cost instead of the marginal cost to the patient.


### Question 4:
Add the physician's optimal $x$ to your graph and interpret the difference.<br>

```{tikz echo=FALSE, fig.ext='png', cache=TRUE, tikz-agency2}
\usetikzlibrary{calc}
\begin{tikzpicture}[scale=0.70, every node/.style={black,opacity=1, transform shape}]
\draw [->] (0,0) node [below] {0} -- (0,0) -- (6,0) node [right] {$x$};
\draw [->] (0,0) node [below] {0} -- (0,0) -- (0,5.5) node [above] {$NB$};
\draw (0,5)--(6,1.4);
\node [right] at (6,1.4) {$b(x)$};
\draw (0,3.5)--(3.4,3.5);
\draw (0,3)--(3.4,3);
\draw (3.4,3.5)--(3.4,0);
\draw[dashed] (2.5,3.5)--(2.5,0);
\node [left] at (0,3) {$c$};
\node [left] at (0,3.5) {$p$};
\node [below] at (3.4,0) {$x^{*}$};
\node [below] at (2.5,0) {$\bar{x}$};
\end{tikzpicture}
```


# Agency and fixed prices {.tabset}

## Problems
Assume $B(x)=4x^{1/2}$, $NB^{0}=0$, anc $c=1$. Further assume that prices are fixed administratively at, $\bar{p}=2$.

### Question 1:
What is the physician's and patient's optimal amount of care provided?

### Question 2:
The government is considering increasing the price to $\bar{p}=3$. What are the new optimal levels of care for physicians and patients at this new price?

### Question 3:
How would the price change affect the difference between the patient and physician's optimal amounts?


## Solutions
Assume $B(x)=4x^{1/2}$, $NB^{0}=0$, anc $c=1$. Further assume that prices are fixed administratively at, $\bar{p}=2$.

### Question 1:
What is the physician's and patient's optimal amount of care provided?<br>

The physician maximizes profit, $\pi = px - cx$, subject to the constraint, $4x^{1/2} = px$. Since $p$ is fixed, the physician simply sets $x$ as high as possible, which means they set $x$ to the point where the constraint binds. With $p=2$, this means $4x^{1/2} = 2x$, and solving for $x$ means $16x = 4x^{2} \longrightarrow 16=4x \longrightarrow x=4$. 

The patient cares about maximizing net benefit, $4x^{1/2} - 2x$. This is maximized at $x$ such that $2x^{-1/2}-2=0 \longrightarrow x=1$. 

### Question 2:
The government is considering increasing the price to $\bar{p}=3$. What are the new optimal levels of care for physicians and patients at this new price?<br>

At this new price, the physician would choose $x$ such that $4x^{1/2} = 3x \longrightarrow 16x = 9x^{2} \longrightarrow 16=9x \longrightarrow x=\frac{16}{9}$. The patient would choose $x$ such that $2x^{-1/2}-3=0 \longrightarrow x=4/9$. 

### Question 3:
How would the price change affect the difference between the patient and physician's optimal amounts?<br>

First, note that the amount of care decreases as the administrative price increases (opposite of the standard supply curve). Similarly, the deviation between the patient and physician optimal amounts decreases.